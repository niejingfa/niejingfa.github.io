I"O
<p>###</p>
<ul>
  <li>需求背景：取出一对多数据中的最后一条做 <code class="highlighter-rouge">SQL</code> 
<code class="highlighter-rouge">JOIN</code> 查询</li>
  <li>例子： 表 <code class="highlighter-rouge">project</code> 1 对 n 表 <code class="highlighter-rouge">rejected_projects</code>， 外键： <code class="highlighter-rouge">project_id</code></li>
  <li>
    <p>描述：通过 <code class="highlighter-rouge">GROUP BY</code> 对外键 <code class="highlighter-rouge">project_id</code> 分组，按条件取出最后一条数据，做成一个id集合， 然后 <code class="highlighter-rouge">JOIN</code> 这个集合取出整条记录的集合， 最后 <code class="highlighter-rouge">JOIN</code> 这个记录的集合进行复查查询</p>
  </li>
  <li><code class="highlighter-rouge">SQL</code> 实例:
    <ol>
      <li>id集合：
        <pre><code class="language-SQL">select max(rp.id) as rp_id, rp.project_id as project_id from rejected_projects rp group by rp.project_id
</code></pre>
      </li>
    </ol>
  </li>
</ul>

<ol>
  <li><code class="highlighter-rouge">JOIN</code> 这个id集合取出整条记录的集合
    <pre><code class="language-SQL">select rp.* from rejected_projects rp
join (select max(rp.id) as rp_id, rp.project_id as project_id from rejected_projects rp group by rp.project_id) rp_dump on rp_dump.rp_id = rp.id
</code></pre>
  </li>
  <li><code class="highlighter-rouge">JOIN</code> 这个记录集合进行复杂查询</li>
</ol>

<pre><code class="language-SQL">select * from projects JOIN (
  select rp.* from rejected_projects rp
  join (select max(rp.id) as rp_id, rp.project_id as project_id from rejected_projects rp group by rp.project_id) rp_dump on rp_dump.rp_id = rp.id
) rp2 on rp2.project_id = projects.id
</code></pre>
<h3 id="第二种---子查询">第二种 - 子查询</h3>
<ul>
  <li>需求背景：某些联表查询</li>
  <li>
    <p>例子： 表 <code class="highlighter-rouge">project</code> 1 对 n 表 <code class="highlighter-rouge">rejected_projects</code>， 外键： <code class="highlighter-rouge">project_id</code></p>
  </li>
  <li><em>JOIN SQL</em></li>
</ul>

<pre><code class="language-SQL">select * from projects p join rejected_projects rp on rp.project_id = p.id where rp.created_at &gt; '2019-12-11 00:00:00'
</code></pre>
<ul>
  <li><em>EXISTS SQL</em></li>
</ul>

<pre><code class="language-SQL">select * from projects where 
exists (select 1 from rejected_projects rp where rp.project_id=projects.id and rp.created_at &gt; '2019-12-11 00:00:00')
</code></pre>
<ul>
  <li>适用场景: 被 JOIN 的表很大</li>
</ul>
:ET