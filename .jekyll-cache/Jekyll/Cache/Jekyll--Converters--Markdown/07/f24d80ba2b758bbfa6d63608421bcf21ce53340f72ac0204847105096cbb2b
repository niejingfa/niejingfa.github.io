I"p<h3 id="1-æ²™ç›’sandboxæ¨¡å¼">1. æ²™ç›’(<code class="highlighter-rouge">sandbox</code>)æ¨¡å¼</h3>
<ul>
  <li>
    <h4 id="å¯ç”¨æ²™ç›’æ¨¡å¼è¿›è¡Œæµ‹è¯•rails-c---sandbox">å¯ç”¨æ²™ç›’æ¨¡å¼è¿›è¡Œæµ‹è¯•ï¼Œ<code class="highlighter-rouge">rails c --sandbox</code></h4>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="c1"># Any modifications you make will be rolled back on exit</span></code></pre></figure>

<ul>
  <li>
    <h4 id="sandbox-æ¨¡å¼ä¼šæ¨¡æ‹Ÿ-å¢åˆ æ”¹-æ•°æ®ä»¥åŠå…³è”å…³ç³»å¹¶ä¸ä¼šæäº¤äº‹åŠ¡æ‰€ä»¥ä¸ä¼šæ’å…¥åˆ°åº“-æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåœ¨é€€å‡ºçš„æ—¶å€™-rollback"><code class="highlighter-rouge">sandbox</code> æ¨¡å¼ï¼Œä¼šæ¨¡æ‹Ÿ å¢åˆ æ”¹ æ•°æ®ä»¥åŠå…³è”å…³ç³»ï¼Œå¹¶ä¸ä¼šæäº¤äº‹åŠ¡ï¼Œæ‰€ä»¥ä¸ä¼šæ’å…¥åˆ°åº“ï¼Œ æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåœ¨é€€å‡ºçš„æ—¶å€™ <code class="highlighter-rouge">rollback</code></h4>
  </li>
</ul>

<h3 id="2-delete_all">2. <code class="highlighter-rouge">delete_all</code></h3>
<ul>
  <li>
    <h4 id="delete_all-ä¸ä¼šèµ°-callback-ä¼šç›´æ¥ç”Ÿæˆä¸€æ¡-delete-sql-è¯­å¥æ¯”å¦‚"><code class="highlighter-rouge">delete_all</code> ä¸ä¼šèµ° <code class="highlighter-rouge">callback</code>, ä¼šç›´æ¥ç”Ÿæˆä¸€æ¡ <code class="highlighter-rouge">delete SQL</code> è¯­å¥ï¼Œæ¯”å¦‚ï¼š</h4>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="no">Project</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="mi">1</span><span class="p">).</span><span class="nf">delete_all</span>
<span class="c1"># =&gt;</span>
<span class="c1"># DELETE FROM "PROJECTS" WHERE "PROJECTS"."ID" = :a1  [["id", 1]]</span></code></pre></figure>

<h3 id="3-destroy_all">3. <code class="highlighter-rouge">destroy_all</code></h3>
<ul>
  <li>
    <h4 id="destroy_all-ä¼šèµ°-callbackç›¸å…³çš„æ•°æ®ä¹Ÿéƒ½åˆ é™¤-ä¼šç”Ÿæˆå¤šæ¡-delete-sql-è¯­å¥"><code class="highlighter-rouge">destroy_all</code> ä¼šèµ° <code class="highlighter-rouge">callback</code>ï¼ˆç›¸å…³çš„æ•°æ®ä¹Ÿéƒ½åˆ é™¤ï¼‰, ä¼šç”Ÿæˆå¤šæ¡ <code class="highlighter-rouge">delete SQL</code> è¯­å¥</h4>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Project</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">destroy_all</span>
<span class="c1"># =&gt;</span>
<span class="c1"># DELETE FROM "PROJECTS" WHERE "PROJECTS"."ID" = :a1  [["id", 1]]</span>
<span class="c1"># DELETE FROM "PROJECTS" WHERE "PROJECTS"."ID" = :a1  [["id", 2]]</span></code></pre></figure>

<ul>
  <li>
    <h4 id="åŒæ—¶ä¹Ÿä¼šæŠŠæ¨¡å‹ä¸­-has_many-é…ç½®äº†-dependent-delete_all-æˆ–è€…-dependent-destroy-çš„ç»™åˆ é™¤æ‰">åŒæ—¶ä¹Ÿä¼šæŠŠæ¨¡å‹ä¸­ <code class="highlighter-rouge">has_many</code> é…ç½®äº† <code class="highlighter-rouge">dependent: :delete_all</code> æˆ–è€… <code class="highlighter-rouge">dependent: :destroy</code> çš„ç»™åˆ é™¤æ‰</h4>
  </li>
</ul>

<h4 id="31-has_many-ä¸­çš„å‚æ•°-dependent-delete_all">3.1. <code class="highlighter-rouge">has_many</code> ä¸­çš„å‚æ•° <code class="highlighter-rouge">dependent: :delete_all</code></h4>
<ul>
  <li>
    <h4 id="dependent-delete_all-ä¼šç”Ÿæˆä¸€æ¡-delete-sql-è¯­å¥-has_many-å…³ç³»æ•°æ®å…¨éƒ¨åˆ é™¤-has_manyå…³è”çš„æ¨¡å‹ä¸ä¼šèµ°-callback"><code class="highlighter-rouge">dependent: :delete_all</code> ä¼šç”Ÿæˆä¸€æ¡ <code class="highlighter-rouge">delete SQL</code> è¯­å¥, <code class="highlighter-rouge">has_many</code> å…³ç³»æ•°æ®å…¨éƒ¨åˆ é™¤, <code class="highlighter-rouge">has_many</code>å…³è”çš„æ¨¡å‹ä¸ä¼šèµ° <code class="highlighter-rouge">callback</code></h4>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Project</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">destroy_all</span>
<span class="c1"># =&gt;</span>
<span class="c1"># DELETE FROM "PROJECTS" WHERE "PROJECTS"."ID" = :a1  [["id", 1]]</span>
<span class="c1"># DELETE FROM "PROJECT_EXTRA_PROPERTIES" WHERE "PROJECT_EXTRA_PROPERTIES"."PROJECT_ID" = :a1  [["project_id", 1]]</span>
<span class="c1"># DELETE FROM "PROJECTS" WHERE "PROJECTS"."ID" = :a1  [["id", 2]]</span>
<span class="c1"># DELETE FROM "PROJECT_EXTRA_PROPERTIES" WHERE "PROJECT_EXTRA_PROPERTIES"."PROJECT_ID" = :a1  [["project_id", 2]]</span></code></pre></figure>

<h4 id="32-has_many-ä¸­çš„å‚æ•°-dependent-destroy_all">3.2. <code class="highlighter-rouge">has_many</code> ä¸­çš„å‚æ•° <code class="highlighter-rouge">dependent: :destroy_all</code></h4>

<ul>
  <li>
    <h4 id="dependent-destroy-ä¼šç”Ÿæˆå¤šæ¡-delete-sql-è¯­å¥-has_many-å…¨éƒ¨åˆ é™¤-ä¼šèµ°-callbackç›¸å…³çš„æ•°æ®ä¹Ÿéƒ½åˆ é™¤"><code class="highlighter-rouge">dependent: :destroy</code> ä¼šç”Ÿæˆå¤šæ¡ <code class="highlighter-rouge">delete SQL</code> è¯­å¥, <code class="highlighter-rouge">has_many</code> å…¨éƒ¨åˆ é™¤, ä¼šèµ° <code class="highlighter-rouge">callback</code>ï¼ˆç›¸å…³çš„æ•°æ®ä¹Ÿéƒ½åˆ é™¤ï¼‰</h4>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Project</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">destroy_all</span>
<span class="c1"># =&gt;</span>
<span class="c1"># DELETE FROM "PROJECT_EXTRA_PROPERTIES" WHERE "PROJECT_EXTRA_PROPERTIES"."ID" = :a1  [["id", 1804]]</span>
<span class="c1"># DELETE FROM "PROJECT_EXTRA_PROPERTIES" WHERE "PROJECT_EXTRA_PROPERTIES"."ID" = :a1  [["id", 1803]]</span></code></pre></figure>

<p>ç‰¹åˆ«æ³¨æ„ï¼š
Project.find(1).project_extra_properties.delete_all, å¹¶ä¸ä¸€å®šä¼šç”Ÿæˆä¸€æ¡ delete SQL è¯­å¥</p>

<ol>
  <li>å¦‚æœä½ çš„ has_many é…ç½®äº† dependent å‚æ•° dependent: :destroy æˆ–è€… dependent: :delete_all
ä¼šç”Ÿæˆä¸€æ¡ delete SQL è¯­å¥
    <h1 id="delete-from-project_extra_properties-where-project_extra_propertiesproject_id--a1--project_id-1">DELETE FROM â€œPROJECT_EXTRA_PROPERTIESâ€ WHERE â€œPROJECT_EXTRA_PROPERTIESâ€.â€PROJECT_IDâ€ = :a1  [[â€œproject_idâ€, 1]]</h1>
  </li>
  <li>å¦‚æœä½ çš„ has_many æ²¡æœ‰é…ç½® dependent: :destroy
è€Œæ˜¯ä¼šç”Ÿæˆä¸€æ¡ update SQL è¯­å¥
    <h1 id="update-project_extra_properties-set-project_extra_propertiesproject_id--null-where-project_extra_propertiesproject_id--a1--project_id-1">UPDATE â€œPROJECT_EXTRA_PROPERTIESâ€ SET â€œPROJECT_EXTRA_PROPERTIESâ€.â€PROJECT_IDâ€ = NULL WHERE â€œPROJECT_EXTRA_PROPERTIESâ€.â€PROJECT_IDâ€ = :a1  [[â€œproject_idâ€, 1]]</h1>
  </li>
</ol>

:ET